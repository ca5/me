ca5.me
===========

## Google Drive連携設定 (画像ダウンロード用)

このプロジェクトでは、Next.jsのビルド時にGoogle Driveから画像を自動でダウンロードします。その際、プログラムがGoogle Driveに安全にアクセスするために、「サービスアカウント」という特別なアカウントを使用します。

以下の手順に従ってサービスアカウントを作成し、その認証情報をプロジェクトに設定してください。

### ステップ1：Google Cloudプロジェクトの選択または作成

1.  [Google Cloud Console](https://console.cloud.google.com/)にアクセスします。
2.  画面上部のプロジェクト選択ドロップダウンから、このサイトに関連付けるプロジェクトを選択します。もし適切なプロジェクトがなければ、「新しいプロジェクト」を作成してください。

### ステップ2：Google Drive APIの有効化

1.  左側のナビゲーションメニューから「APIとサービス」 > 「ライブラリ」を選択します。
2.  検索バーに「**Google Drive API**」と入力し、検索結果からそれを選択します。
3.  「有効にする」ボタンをクリックします。

### ステップ3：サービスアカウントの作成

1.  左側のナビゲーションメニューから「APIとサービス」 > 「認証情報」を選択します。
2.  「+ 認証情報を作成」をクリックし、「サービスアカウント」を選択します。
3.  **サービスアカウント名**を入力します（例: `static-site-image-downloader`）。
4.  「作成して続行」をクリックします。
5.  **ロールの選択**は不要です。「続行」をクリックします。
6.  **ユーザーへのこのサービスアカウントへのアクセスを許可**も不要です。「完了」をクリックします。

### ステップ4：サービスアカウントキー（JSONファイル）の作成と取得

1.  認証情報の一覧に、先ほど作成したサービスアカウントが表示されます。そのメールアドレス（`...@....iam.gserviceaccount.com`）を**コピーして控えておいてください**（ステップ5で使用します）。
2.  サービスアカウントの行をクリックし、「キー」タブを選択します。
3.  「鍵を追加」 > 「新しい鍵を作成」を選択します。
4.  キーのタイプとして「**JSON**」を選択し、「作成」をクリックします。
5.  JSONファイルが自動的にダウンロードされます。**このファイルは非常に重要なので、安全な場所に保管してください。絶対にGitリポジトリに含めないでください。**

### ステップ5：Google Driveフォルダの共有設定

1.  Google Driveで、画像をアップロードするフォルダ（GASスクリプトが設置されているスプレッドシートと同じフォルダ）を開きます。
2.  フォルダ名を右クリックし、「共有」を選択します。
3.  「ユーザーやグループと共有」の入力欄に、ステップ4で控えておいたサービスアカウントのメールアドレスを貼り付けます。
4.  権限が「閲覧者」になっていることを確認し、「送信」をクリックします。

### ステップ6：認証情報を環境変数として設定

ビルドサーバー（Vercel, Netlify, GitHub Actionsなど）やローカルの開発環境で、以下の環境変数を設定する必要があります。

-   **環境変数名**: `GOOGLE_APPLICATION_CREDENTIALS_JSON`
-   **値**: ステップ4でダウンロードしたJSONファイルの中身**全体**を、改行などを削除せずそのままコピーして貼り付けます。

以上の設定が完了すると、`pnpm build`を実行した際に、プログラムがサービスアカウントとしてGoogle Drive APIを認証し、共有されたフォルダから画像を安全にダウンロードできるようになります。
